<div class="auth-container">
  <p-card header="Forgot Password" [style]="{ width: '30rem' }">
    <div class="p-fluid">

      <!-- Step 1: Choose method -->
      @if (currentStep === 'choose') {
        <p>Select a recovery method:</p>
        <div class="p-field-radiobutton">
          <p-radioButton name="method" inputId="method-email" value="email" [(ngModel)]="method" label="Reset Link"></p-radioButton>Reset Link
        </div><br>
        <div class="p-field-radiobutton">
          <p-radioButton name="method" inputId="method-otp" value="otp" [(ngModel)]="method" label="OTP"></p-radioButton>OTP
        </div><br>
        <button pButton type="button" label="Continue" (click)="chooseMethod()"></button>
      }

<!-- Step 2a: Enter email for Reset Link -->
@if (currentStep === 'emailLink' && method === 'email') {
  <form [formGroup]="emailForm" (ngSubmit)="sendLink()">
    <p-floatLabel variant="in">
      <input pInputText id="email" formControlName="email" />
      <label for="email">Email</label>
    </p-floatLabel>
    <button pButton type="submit" label="Send Link"></button>
  </form>
}


      <!-- Step 2: Enter email for OTP -->
      @if (currentStep === 'otpEmail' && method === 'otp') {
        <form [formGroup]="otpEmailForm" (ngSubmit)="requestOtp()">
          <p-floatLabel variant="in">
            <input pInputText id="otpEmail" formControlName="email" />
            <label for="otpEmail">Email</label>
          </p-floatLabel>
          <button pButton type="submit" label="Send OTP"></button>
        </form>
      }

      <!-- Step 3: OTP entry -->
      @if (currentStep === 'otpEntry') {
        <p-inputOtp [(ngModel)]="otpValue" [length]="otpLength" (onChange)="onOtpChange($event)"></p-inputOtp>
        <button pButton type="button" label="Submit OTP" (click)="submitOtp()"></button>
      }

      <!-- Step 4: Reset password -->
      @if (currentStep === 'resetPassword') {
        <form [formGroup]="otpResetForm" (ngSubmit)="verifyAndReset()">
          <p-floatLabel variant="in">
            <p-password inputId="newPassword" formControlName="newPassword"></p-password>
            <label for="newPassword">New password</label>
          </p-floatLabel>
          <p-floatLabel variant="in">
            <p-password inputId="confirmPassword" formControlName="confirmPassword"></p-password>
            <label for="confirmPassword">Confirm new password</label>
          </p-floatLabel>
          <button pButton type="submit" label="Reset"></button>
        </form>
      }

      @if (errorMessage) {
        <p class="error">{{ errorMessage }}</p>
      }
    </div>
  </p-card>
</div>
